// ==UserScript==
// @name         CheckItForMe
// @version      0.50
// @match        https://scrap.tf/raffles
// @require      https://code.jquery.com/jquery-2.2.4.min.js#sha256=BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44
// @updateURL    https://raw.githubusercontent.com/GuilloOme/CheckThisForMe/master/dist/check-it-for-me.js
// @grant        none
// ==/UserScript==
!function(A){function t(a){if(e[a])return e[a].exports;var n=e[a]={exports:{},id:a,loaded:!1};return A[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var e={};return t.m=A,t.c=e,t.p="",t(0)}([function(A,t,e){!function(){"use strict";function A(){function A(e){var l,w;ScrapTF.Raffles.EnterRaffle=function(A,t){l=A,w=t},o.showMessage("Checking raffle: "+(u+1)+"/"+c.length),$.get(e,function(d){var h,v=jQuery.Deferred(),B=$(d).find("#raffle-key").val(),p=$(d).find("button#raffle-enter"),M=a(d);r.isRaffleWorthIt(M)?p.length>0&&"Enter Raffle"===$(d).find("button#raffle-enter>i18n").html()?(o.showMessage("Entering raffle: "+(u+1)+"/"+c.length),$(d).find("button#raffle-enter").click(),h={raffle:l,captcha:"",rafflekey:B,password:"",hash:w},ScrapTF.Ajax("viewraffle/EnterRaffle",h,function(){v.resolve("Done entering raffle: "+(u+1)+"/"+c.length,!0)},function(A){A.captcha?(showIcon("Warning"),setTimeout(function(){location.reload()},1e3*s),v.reject("Captcha requested! Reloading in "+s/60+"minutes…")):v.resolve("Error when entering raffle: "+(u+1)+"/"+c.length+" - "+A.message)})):v.resolve("Can't enter raffle: "+(u+1)+"/"+c.length+" (no button to click)"):(g.push(e),n(g),v.resolve("Raffle not worth it: "+(u+1)+"/"+c.length)),$.when(v.promise()).then(function(e,a){var n=i.randomInterval();o.showMessage(e),o.updateProgress((u+1)/c.length,u+1+"/"+c.length),a&&(n=i.randomInterval(f)),u++,u<c.length?setTimeout(function(){A(c[u])},n):t.resolve()})})}var t=jQuery.Deferred();return o.addProgress("",0,"success"),A(c[u]),t.promise()}function t(){var A=jQuery.Deferred(),t=setInterval(function(){ScrapTF.Raffles.Pagination.isDone?(A.resolve(),clearInterval(t)):ScrapTF.Raffles.Pagination.LoadNext()},i.randomInterval());return A.promise()}function a(A){for(var t=$(A).find(".raffle-items>div"),e={timeLeft:Math.floor(parseInt($(A).find("dd.raffle-time-left").attr("data-time"))-(new Date).getTime()/1e3),winChance:parseInt($(A).find("#raffle-win-chance").html()),totalEntries:parseInt($(A).find("span#raffle-num-entries").attr("data-max")),haveSpecials:!1,count:0},a=0;a<=t.length;a++){var n=$(t[a]);if("440"===n.attr("data-appid")){var i=function(A){return"misc"===A.attr("data-slot")||"taunt"===A.attr("data-slot")},o=function(A){return"all"===A.attr("data-slot")&&(A.attr("data-title").match("Reclaimed Metal")||A.attr("data-title").match("Refined Metal")||A.attr("data-title").match("Key")||A.attr("data-title").match("Ticket"))},l=function(A){var t=A.attr("class");return t.match("killstreak")||t.match("rarity")||t.match("quality3")||t.match("quality1")||t.match("quality11")||t.match("quality5")||t.match("token")},s=function(A){return $(A).find("div.paintcolor").length>0||$(A).find("img.festive").length>0};o(n)||i(n)||l(n)||s(n);r.isItemSpecial(n)&&(e.haveSpecials=!0),e.count++}}return e}function n(A){d&&(localStorage.badRaffleList=JSON.stringify(A))}var r=e(1).RaffleService,i=e(3).IntervalHelper,o=e(2).UIHelper,l=50,s=300,f=3,c=r.goodList,g=r.badList,u=0,w=i.randomInterval(l),d=!1;$(document).ready(function(){o.createBotPanel(),o.showMessage("Started"),"undefined"!=typeof Storage&&(d=!0,"string"!=typeof localStorage.badRaffleList&&n([]),JSON.parse(localStorage.badRaffleList).length>1e3?(console.warn("Purging bad raffle cache!"),n([])):g=g.concat(JSON.parse(localStorage.badRaffleList))),o.getUserNoticeCount()>0&&(o.showMessage("There is new message(s)!"),o.showIcon("Ok")),o.showMessage("Loading all the raffles…"),$.when(t()).then(function(){var t=$("div.panel");if($(t[t.length-1]).find("div.panel-raffle").each(function(A,t){var e=$(t).find("div.raffle-name > a").attr("href");"1"===$(t).css("opacity")&&g.indexOf(e)<0&&c.push(e)}),c.length>0)$.when(A()).then(function(){location.reload()});else{o.showMessage("No new raffle to enter, waiting…"),o.addProgress("",0);var e=1e3;setInterval(function(){o.updateProgress(e/w),e+=250},250),setTimeout(function(){location.reload()},w)}})})}()},function(A,t,e){!function(){"use strict";function A(){function A(A){var t=!1;return A.count>0&&(A.haveSpecials?t=!0:A.totalEntries<=e?t=!0:A.count>=n?t=!0:A.timeLeft<r&&(t=!0)),t}function t(A){var t=0;return Object.keys(o).forEach(function(e){var n=o[e];Object.keys(n).forEach(function(e){"weight"!==e&&a.checkAttribute(A,e,n[e])&&(t+=n.weight)})}),console.log(t),t>=i}var e=300,n=15,r=3600,i=9,o={reinforcedPart:{weight:.05,title:"Reinforced "},battleWornPart:{weight:2,title:"Battle-Worn "},pristinePart:{weight:4,title:"Pristine "},scrapMetal:{weight:1,title:"Scrap Metal"},reclaimedMetal:{weight:3,title:"Reclaimed Metal"},refinedMetal:{weight:9,title:"Refined Metal"},token:{weight:1.5,"class":"token"},uncraftable:{weight:.01,"class":"uncraft"},action:{weight:1,slot:"action"},unique:{weight:.5,"class":"quality6"},fabricator:{weight:1,title:"Fabricator"},vintage:{weight:3,"class":"quality3"},genuine:{weight:3,"class":"quality1"},gift:{weight:9,title:"Gift"},rare:{weight:9,"class":"rarity"},strange:{weight:18,"class":"quality11"},cosmetic:{weight:18,slot:"misc"},colored:{weight:18,content:"div.paintcolor"},festive:{weight:18,content:"img.festive"},killstreak:{weight:27,"class":"killstreak"},taunt:{weight:45,slot:"taunt"},key:{weight:180,title:"Key"},ticket:{weight:180,title:"Ticket"},unusual:{weight:1e3,"class":"quality5"}},l=[],s=[];return{isRaffleWorthIt:A,isItemSpecial:t,goodList:l,badList:s}}var a=e(2).UIHelper;t.RaffleService=new A}()},function(A,t){!function(){"use strict";function A(){function A(){var A=$('<div class="panel panel-info"><div class="panel-body">Bot: <span class="botMessage"></span></div></div>');$("body>div.container").prepend(A),o=A}function t(A){o.find("span.botMessage").text(A),console.info(A)}function e(A){var t="";"Ok"===A?t='<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG0QYXBtEGTQbRBk8G0QZPBtEGTwbRBk8G0QZPBtEGTwbRBkkG0QYKAAAAAAAAAAAAAAAAAAAAAAAAAAAG0QYQBtEG5wbRBv8G0Qb/BtEG/wbRBv8G0Qb/BtEG/wbRBv8G0Qb/BtEGwAXRBQAAAAAAAAAAAAAAAAAAAAAABtEGOQbRBv/J9cn/z/bP/6bvpv9/53//nO2c/53tnf/u/O7/l+yX/wbRBvkF0QUHAAAAAAAAAAAAAAAAAAAAAAbRBjoG0Qb/2/jb/yjXKP8G0Qb/EdMR/0zeTP9C3EL/6vvq/6TupP8G0Qb5BdEFCAAAAAAAAAAAAAAAAAAAAAAG0QY6BtEG/9v42/8l1yX/BtEG/xHTEf9M3kz/Nto2/7Xxtf+k7qT/BtEG+QXRBQgAAAAAAAAAAAAAAAAAAAAABtEGOgbRBv/b+Nv/jeqN/xjUGP8S0xL/TN5M/zfaN//F9MX/pO6k/wbRBvkF0QUIAAAAAAAAAAAAAAAAAAAAAAbRBjoG0Qb/2/jb//////+B6IH/FNQU/8X0xf+9873/9v32/6TupP8G0Qb5BdEFCAAAAAAAAAAAAAAAAAAAAAAG0QY6BtEG/9v42///////6vvq/w/TD//z/fP///////////+k7qT/BtEG+QXRBQgAAAAAAAAAAAAAAAAAAAAABtEGOQbRBv/T99P/+f75//n++f+b7Zv/9f31//n++f/5/vn/nu2e/wbRBvkF0QUIAAAAAAAAAAAAAAAAAAAAAAbRBhMG0QbtB9EH/wjRCP8I0Qj/CNEI/wjRCP8I0Qj/CNEI/wfRB/8G0QbHBdEFAQAAAAAAAAAAAAAAAAAAAAAAAAAABtEGHwbRBlsG0QZdBtEGXQbRBl0G0QZdBtEGXQbRBl0G0QZWBtEGDwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//wAA4AcAAMADAADAAwAAwAMAAMADAADAAwAAwAMAAMADAADAAwAAwAMAAOAHAAD//wAA//8AAA==" rel="icon" type="image/x-icon">':"Warning"===A&&(t='<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAADAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABwAAAAcAAAADAAAAmwAHCcIACQvCAAkLwgAJC8IACQvCAAkLwgAJDMIACQzCAAkMwgAJDMIACQzCAAkMwgAJDMIACArDAAAAmwAAAGsAbIf4AMz//wDM//8AzP//AMz//wDM//8Auun/AK/b/wDM//8AzP//AMz//wDM//8AzP//AGyH+QAAAGsAAAAZAA0QtgC24/8AzP//AMz//wDM//8AzP//Ai86/wMLDf8AwvP/AMz//wDM//8AzP//ALfk/wAOEbgAAAAZAAAAAAAAAFAAT2LqAMz//wDM//8AzP//AMz//wF/n/8CYXn/AMv+/wDM//8AzP//AMz//wBRZesAAABSAAAAAAAAAAAAAAAIAAIDngCcw/8AzP//AMz//wDM//8AeZj/AHSR/wDM//8AzP//AMz//wCfx/8AAwShAAAACQAAAAAAAAAAAAAAAAAAADgAMDzYAMr8/wDM//8AzP//ACQt/wAbIv8AzP//AMz//wDL/f8ANEHbAAAAOwAAAAAAAAAAAAAAAAAAAAAAAAABAAAAfQB9nP4AzP//AMz//wAcI/8AFBj/AMz//wDM//8AgqP+AAAAggAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACMAGB7DAL/v/wDM//8AFBn/AA0Q/wDL/v8AwvL/ABwjyAAAACcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXwBgePMAy/7/AA0Q/wAHCf8Ayfv/AGaA9gAAAGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEABwisAKvV/wAPE/8ACgz/AK7Z/wAKDLIAAAAVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARgBCUuIAn8f/AJzD/wBLXecAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAGRAI+y/wCZv/8AAQKbAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALwAlLtAALTnWAAAANgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABvAAAAeQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIABAACAAQAAwAMAAMADAADgBwAA8A8AAPAPAAD4HwAA+B8AAPw/AAD8PwAA/n8AAA==" rel="icon" type="image/x-icon">'),$('link[rel*="icon"]').remove(),$("head").append(t)}function a(A,t,e){e||(e="info"),l=$('<div class="progress"><div class="progress-bar progress-bar-'+e+'" role="progressbar" aria-valuenow="'+100*t+'" aria-valuemin="0" aria-valuemax="100" style="width: '+100*t+'%;">'+A+"</div></div>"),o.find(".botMessage").after(l)}function n(A,t){l.find("div.progress-bar").attr("aria-valuenow",100*A),l.find("div.progress-bar").css("width",100*A+"%"),t&&l.find("div.progress-bar").text(t)}function r(){return parseInt($(".user-notices-count").html())}function i(A,t,e){var a={title:"data-title",slot:"data-slot","class":"class"},n=!1;return n="content"===t?$(A).find(e).length>0:!!A.attr(a[t]).match(e)}var o,l;return{createBotPanel:A,showMessage:t,showIcon:e,addProgress:a,updateProgress:n,getUserNoticeCount:r,checkAttribute:i}}t.UIHelper=new A}()},function(A,t){!function(){"use strict";function A(){function A(A){return A||(A=.5),Math.floor(1e3*A)+Math.floor(Math.random()*(1e3*A))}return{randomInterval:A}}t.IntervalHelper=new A}()}]);