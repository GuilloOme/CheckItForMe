// ==UserScript==
// @name         CheckItForMe
// @version      0.48
// @match        https://scrap.tf/raffles
// @require      https://code.jquery.com/jquery-2.2.4.min.js#sha256=BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44
// @updateURL    https://raw.githubusercontent.com/GuilloOme/CheckThisForMe/master/checkItForMe.js
// @grant        none
// ==/UserScript==
!function(A){function e(n){if(t[n])return t[n].exports;var a=t[n]={exports:{},id:n,loaded:!1};return A[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var t={};return e.m=A,e.c=t,e.p="",e(0)}([function(A,e){!function(){"use strict";function A(){var A=window.location.href,t=/https:\/\/scrap.tf\/raffles/;if(A.match(t)&&n())e();else{B("No new raffle to enter, waiting…"),u=s("",0,v);var a=1e3;setInterval(function(){g(u,a/E),a+=250},250),setTimeout(function(){location.reload()},E)}}function e(){B("Loading all the raffles…"),$.when(a()).then(function(){var A=$("div.panel");if($(A[A.length-1]).find("div.panel-raffle").each(function(A,e){var t=$(e).find("div.raffle-name > a").attr("href");"1"===$(e).css("opacity")&&z.indexOf(t)<0&&b.push(t)}),b.length>0)$.when(t()).then(function(){location.reload()});else{B("No new raffle to enter, waiting…"),u=s("",0,v);var e=1e3;setInterval(function(){g(u,e/E),e+=250},250),setTimeout(function(){location.reload()},E)}})}function t(){function A(t){var n,a;ScrapTF.Raffles.EnterRaffle=function(A,e){n=A,a=e},B("Checking raffle: "+(C+1)+"/"+b.length),$.get(t,function(w){var s,v=jQuery.Deferred(),d=$(w).find("#raffle-key").val(),h=$(w).find("button#raffle-enter"),Q=o(w);l(Q)?h.length>0&&"Enter Raffle"===$(w).find("button#raffle-enter>i18n").html()?(B("Entering raffle: "+(C+1)+"/"+b.length),$(w).find("button#raffle-enter").click(),s={raffle:n,captcha:"",rafflekey:d,password:"",hash:a},ScrapTF.Ajax("viewraffle/EnterRaffle",s,function(){v.resolve("Done entering raffle: "+(C+1)+"/"+b.length,!0)},function(A){A.captcha?(i("Warning"),f("Error when entering raffle:\nCaptcha requested!","https://scrap.tf/raffles/"+n),b.forEach(function(A){window.open(A)}),setTimeout(function(){location.reload()},1e3*M),v.reject("Captcha requested! Reloading in "+M/60+"minutes…")):v.resolve("Error when entering raffle: "+(C+1)+"/"+b.length+" - "+A.message)})):v.resolve("Can't enter raffle: "+(C+1)+"/"+b.length+" (no button to click)"):(z.push(t),c(z),v.resolve("Raffle not worth it: "+(C+1)+"/"+b.length)),$.when(v.promise()).then(function(t,n){var a=r();B(t),g(u,(C+1)/b.length,C+1+"/"+b.length),n&&(a=r(D)),C++,C<b.length?setTimeout(function(){A(b[C])},a):e.resolve()})})}var e=jQuery.Deferred();return u=s("",0,v,"success"),A(b[C]),e.promise()}function n(){var A=$("div.panel-body>div.text-center>i18n>var").text(),e=A.match(/[0-9]+/gi),t=parseInt(e[1])-parseInt(e[0]);return B("There is "+t+" raffle(s) open."),e.length>1&&t>0}function a(){var A=jQuery.Deferred(),e=setInterval(function(){ScrapTF.Raffles.Pagination.isDone?(A.resolve(),clearInterval(e)):ScrapTF.Raffles.Pagination.LoadNext()},r());return A.promise()}function r(A){return A||(A=.5),Math.floor(1e3*A)+Math.floor(Math.random()*(1e3*A))}function i(A){var e="";"Ok"===A?e='<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG0QYXBtEGTQbRBk8G0QZPBtEGTwbRBk8G0QZPBtEGTwbRBkkG0QYKAAAAAAAAAAAAAAAAAAAAAAAAAAAG0QYQBtEG5wbRBv8G0Qb/BtEG/wbRBv8G0Qb/BtEG/wbRBv8G0Qb/BtEGwAXRBQAAAAAAAAAAAAAAAAAAAAAABtEGOQbRBv/J9cn/z/bP/6bvpv9/53//nO2c/53tnf/u/O7/l+yX/wbRBvkF0QUHAAAAAAAAAAAAAAAAAAAAAAbRBjoG0Qb/2/jb/yjXKP8G0Qb/EdMR/0zeTP9C3EL/6vvq/6TupP8G0Qb5BdEFCAAAAAAAAAAAAAAAAAAAAAAG0QY6BtEG/9v42/8l1yX/BtEG/xHTEf9M3kz/Nto2/7Xxtf+k7qT/BtEG+QXRBQgAAAAAAAAAAAAAAAAAAAAABtEGOgbRBv/b+Nv/jeqN/xjUGP8S0xL/TN5M/zfaN//F9MX/pO6k/wbRBvkF0QUIAAAAAAAAAAAAAAAAAAAAAAbRBjoG0Qb/2/jb//////+B6IH/FNQU/8X0xf+9873/9v32/6TupP8G0Qb5BdEFCAAAAAAAAAAAAAAAAAAAAAAG0QY6BtEG/9v42///////6vvq/w/TD//z/fP///////////+k7qT/BtEG+QXRBQgAAAAAAAAAAAAAAAAAAAAABtEGOQbRBv/T99P/+f75//n++f+b7Zv/9f31//n++f/5/vn/nu2e/wbRBvkF0QUIAAAAAAAAAAAAAAAAAAAAAAbRBhMG0QbtB9EH/wjRCP8I0Qj/CNEI/wjRCP8I0Qj/CNEI/wfRB/8G0QbHBdEFAQAAAAAAAAAAAAAAAAAAAAAAAAAABtEGHwbRBlsG0QZdBtEGXQbRBl0G0QZdBtEGXQbRBl0G0QZWBtEGDwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//wAA4AcAAMADAADAAwAAwAMAAMADAADAAwAAwAMAAMADAADAAwAAwAMAAOAHAAD//wAA//8AAA==" rel="icon" type="image/x-icon">':"Warning"===A&&(e='<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAADAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABwAAAAcAAAADAAAAmwAHCcIACQvCAAkLwgAJC8IACQvCAAkLwgAJDMIACQzCAAkMwgAJDMIACQzCAAkMwgAJDMIACArDAAAAmwAAAGsAbIf4AMz//wDM//8AzP//AMz//wDM//8Auun/AK/b/wDM//8AzP//AMz//wDM//8AzP//AGyH+QAAAGsAAAAZAA0QtgC24/8AzP//AMz//wDM//8AzP//Ai86/wMLDf8AwvP/AMz//wDM//8AzP//ALfk/wAOEbgAAAAZAAAAAAAAAFAAT2LqAMz//wDM//8AzP//AMz//wF/n/8CYXn/AMv+/wDM//8AzP//AMz//wBRZesAAABSAAAAAAAAAAAAAAAIAAIDngCcw/8AzP//AMz//wDM//8AeZj/AHSR/wDM//8AzP//AMz//wCfx/8AAwShAAAACQAAAAAAAAAAAAAAAAAAADgAMDzYAMr8/wDM//8AzP//ACQt/wAbIv8AzP//AMz//wDL/f8ANEHbAAAAOwAAAAAAAAAAAAAAAAAAAAAAAAABAAAAfQB9nP4AzP//AMz//wAcI/8AFBj/AMz//wDM//8AgqP+AAAAggAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACMAGB7DAL/v/wDM//8AFBn/AA0Q/wDL/v8AwvL/ABwjyAAAACcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXwBgePMAy/7/AA0Q/wAHCf8Ayfv/AGaA9gAAAGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEABwisAKvV/wAPE/8ACgz/AK7Z/wAKDLIAAAAVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARgBCUuIAn8f/AJzD/wBLXecAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAGRAI+y/wCZv/8AAQKbAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALwAlLtAALTnWAAAANgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABvAAAAeQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIABAACAAQAAwAMAAMADAADgBwAA8A8AAPAPAAD4HwAA+B8AAPw/AAD8PwAA/n8AAA==" rel="icon" type="image/x-icon">'),$('link[rel*="icon"]').remove(),$("head").append(e)}function f(A,e){if("granted"===Notification.permission){var t=new Notification("Notification",{icon:"data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAADAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABwAAAAcAAAADAAAAmwAHCcIACQvCAAkLwgAJC8IACQvCAAkLwgAJDMIACQzCAAkMwgAJDMIACQzCAAkMwgAJDMIACArDAAAAmwAAAGsAbIf4AMz//wDM//8AzP//AMz//wDM//8Auun/AK/b/wDM//8AzP//AMz//wDM//8AzP//AGyH+QAAAGsAAAAZAA0QtgC24/8AzP//AMz//wDM//8AzP//Ai86/wMLDf8AwvP/AMz//wDM//8AzP//ALfk/wAOEbgAAAAZAAAAAAAAAFAAT2LqAMz//wDM//8AzP//AMz//wF/n/8CYXn/AMv+/wDM//8AzP//AMz//wBRZesAAABSAAAAAAAAAAAAAAAIAAIDngCcw/8AzP//AMz//wDM//8AeZj/AHSR/wDM//8AzP//AMz//wCfx/8AAwShAAAACQAAAAAAAAAAAAAAAAAAADgAMDzYAMr8/wDM//8AzP//ACQt/wAbIv8AzP//AMz//wDL/f8ANEHbAAAAOwAAAAAAAAAAAAAAAAAAAAAAAAABAAAAfQB9nP4AzP//AMz//wAcI/8AFBj/AMz//wDM//8AgqP+AAAAggAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACMAGB7DAL/v/wDM//8AFBn/AA0Q/wDL/v8AwvL/ABwjyAAAACcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXwBgePMAy/7/AA0Q/wAHCf8Ayfv/AGaA9gAAAGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEABwisAKvV/wAPE/8ACgz/AK7Z/wAKDLIAAAAVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARgBCUuIAn8f/AJzD/wBLXecAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAGRAI+y/wCZv/8AAQKbAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALwAlLtAALTnWAAAANgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABvAAAAeQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIABAACAAQAAwAMAAMADAADgBwAA8A8AAPAPAAD4HwAA+B8AAPw/AAD8PwAA/n8AAA==",body:A});t.onclick=function(){window.open(e),t.close()}}}function o(A){for(var e=$(A).find(".raffle-items>div"),t={timeLeft:Math.floor(parseInt($(A).find("dd.raffle-time-left").attr("data-time"))-(new Date).getTime()/1e3),winChance:parseInt($(A).find("#raffle-win-chance").html()),totalEntries:parseInt($(A).find("span#raffle-num-entries").attr("data-max")),haveSpecials:!1,count:0},n=0;n<=e.length;n++){var a=$(e[n]);if("440"===a.attr("data-appid")){var r=function(A){return"misc"===A.attr("data-slot")||"taunt"===A.attr("data-slot")},i=function(A){return"all"===A.attr("data-slot")&&(A.attr("data-title").match("Reclaimed Metal")||A.attr("data-title").match("Refined Metal")||A.attr("data-title").match("Key")||A.attr("data-title").match("Ticket"))},f=function(A){var e=A.attr("class");return e.match("killstreak")||e.match("rarity")||e.match("quality3")||e.match("quality1")||e.match("quality11")||e.match("quality5")||e.match("token")},o=function(A){return $(A).find("div.paintcolor").length>0||$(A).find("img.festive").length>0},l=i(a)||r(a)||f(a)||o(a);l&&(t.haveSpecials=!0),t.count++}}return t}function l(A){var e=!1;return A.count>0&&(A.haveSpecials?e=!0:A.totalEntries<=h?e=!0:A.count>=Q?e=!0:A.timeLeft<p&&(e=!0)),e}function c(A){G&&(localStorage.badRaffleList=JSON.stringify(A))}function w(){var A=$('<div class="panel panel-info"><div class="panel-body">Bot: <span class="botMessage"></span></div></div>');return $("body>div.container").prepend(A),A}function s(A,e,t,n){n||(n="info");var a=$('<div class="progress"><div class="progress-bar progress-bar-'+n+'" role="progressbar" aria-valuenow="'+100*e+'" aria-valuemin="0" aria-valuemax="100" style="width: '+100*e+'%;">'+A+"</div></div>");return t.find(".botMessage").after(a),a}function g(A,e,t){A.find("div.progress-bar").attr("aria-valuenow",100*e),A.find("div.progress-bar").css("width",100*e+"%"),t&&A.find("div.progress-bar").text(t)}function B(A){v.find("span.botMessage").text(A),console.info(A)}var v,u,d=50,M=300,D=3,h=300,Q=15,p=3600,b=[],z=[],C=0,E=r(d),G=!1;$(document).ready(function(){v=w(),B("Started"),"granted"!==Notification.permission&&Notification.requestPermission(),"undefined"!=typeof Storage&&(G=!0,"string"!=typeof localStorage.badRaffleList&&c([]),JSON.parse(localStorage.badRaffleList).length>1e3?(console.warn("Purging bad raffle cache!"),c([])):z=JSON.parse(localStorage.badRaffleList)),parseInt($(".user-notices-count").html())>0&&(B("There is new message(s)!"),i("Ok")),A()})}()}]);