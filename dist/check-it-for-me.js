// ==UserScript==
// @name         CheckItForMe
// @version      0.54
// @match        https://scrap.tf/raffles
// @require      https://code.jquery.com/jquery-2.2.4.min.js#sha256=BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44
// @updateURL    https://raw.githubusercontent.com/GuilloOme/CheckItForMe/master/dist/check-it-for-me.js
// @grant        none
// ==/UserScript==
!function(A){function e(n){if(t[n])return t[n].exports;var a=t[n]={exports:{},id:n,loaded:!1};return A[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var t={};return e.m=A,e.c=t,e.p="",e(0)}([function(A,e,t){!function(){"use strict";function A(){var A=jQuery.Deferred(),e=setInterval(function(){ScrapTF.Raffles.Pagination.isDone?(A.resolve(),clearInterval(e)):ScrapTF.Raffles.Pagination.LoadNext()},n.randomInterval());return A.promise()}var e=t(1).RafflesService,n=t(5).IntervalHelper,a=t(3).UIHelper,i=30,r=180;n.randomInterval(i);$(document).ready(function(){n.safeReloadRoutine(r+i),a.createBotPanel(),a.showMessage("Started"),a.getUserNoticeCount()>0&&(a.showMessage("There is new message(s)!"),a.showIcon("Ok")),a.showMessage("Loading all the raffles…"),$.when(A()).then(function(){var A=$("div.panel");if($(A[A.length-1]).find("div.panel-raffle").each(function(A,t){var n=$(t).find("div.raffle-name > a").attr("href");"1"===$(t).css("opacity")&&e.badList.indexOf(n)<0&&e.goodList.push(n)}),e.goodList.length>0)a.addProgress("",0,"success"),$.when(e.enterRaffles()).then(function(){location.reload()});else{var t=n.randomInterval(i),r=1e3;a.showMessage("No new raffle to enter, waiting…"),a.addProgress("",0),setInterval(function(){a.updateProgress(r/t),r+=250},250),setTimeout(function(){location.reload()},t)}})})}()},function(A,e,t){!function(){"use strict";function A(){function A(){var A=jQuery.Deferred();return e(f[0],A),A.promise()}function e(A,n){var a,g;ScrapTF.Raffles.EnterRaffle=function(A,e){a=A,g=e},r.showMessage("Checking raffle: "+(u+1)+"/"+f.length),$.get(A,function(v){var w,d=jQuery.Deferred(),h=$(v).find("#raffle-key").val(),p=$(v).find("button#raffle-enter");t(A,v)?p.length>0&&"Enter Raffle"===$(v).find("button#raffle-enter>i18n").html()?(r.showMessage("Entering raffle: "+(u+1)+"/"+f.length),$(v).find("button#raffle-enter").click(),w={raffle:a,captcha:"",rafflekey:h,password:"",hash:g},ScrapTF.Ajax("viewraffle/EnterRaffle",w,function(){d.resolve("Done entering raffle: "+(u+1)+"/"+f.length,!0)},function(A){A.captcha?(showIcon("Warning"),setTimeout(function(){location.reload()},1e3*o),d.reject("Captcha requested! Reloading in "+o/60+"minutes…")):d.resolve("Error when entering raffle: "+(u+1)+"/"+f.length+" - "+A.message)})):d.resolve("Can't enter raffle: "+(u+1)+"/"+f.length+" (no button to click)"):(c.push(A),l(c),d.resolve("Raffle not worth it: "+(u+1)+"/"+f.length)),$.when(d.promise()).then(function(A,t){var a=i.randomInterval();r.showMessage(A),r.updateProgress((u+1)/f.length,u+1+"/"+f.length),t&&(a=i.randomInterval(s)),u++,u<f.length?setTimeout(function(){e(f[u],n)},a):n.resolve()})})}function t(A,e){var t=n.build(A,e);return t.isWorthIt}function l(){a.store("badRaffleList",c)}var f=[],c=a.extract("badRaffleList")||[],u=0;return{enterRaffles:A,goodList:f,badList:c}}var n=t(2).Raffle,a=t(4).StorageService,i=t(5).IntervalHelper,r=t(3).UIHelper,o=300,s=3;e.RafflesService=new A}()},function(A,e,t){!function(){"use strict";function A(){function A(A){this.id=A.id,this.url=A.url,this.timeLeft=A.timeLeft,this.winChance=A.winChance,this.totalEntries=A.totalEntries,this.winType=A.winType,this.items=A.items}function e(A){var e=0;return a.forEach(function(t){n.checkAttribute(A,t.type,t.value)&&(e+=t.weight)}),0===e&&(e=.5),e}return A.build=function(t,n){for(var a=$(n).find(".raffle-items>div"),i={id:t.substr(t.lastIndexOf("/")+1),url:t,timeLeft:Math.floor(parseInt($(n).find("dd.raffle-time-left").attr("data-time"))-(new Date).getTime()/1e3),winChance:parseFloat($(n).find("#raffle-win-chance").html()),totalEntries:parseInt($(n).find("span#raffle-num-entries").attr("data-max")),winType:$(n).find("dd.type>i18n").html(),items:[]},r=0;r<=a.length;r++){var o=$(a[r]);"440"===o.attr("data-appid")&&i.items.push(e(o))}return new A(i)},Object.defineProperties(A.prototype,{itemsCount:{get:function(){return this.items.length}},averageItemWeight:{get:function(){var A=0;return this.items.forEach(function(e){A+=e}),A/this.itemsCount}},isWorthIt:{get:function(){var A=!1;return this.itemsCount>0&&(this.averageItemWeight>=s||this.itemMaxWeight>=l?A=!0:this.totalEntries<=i?A=!0:this.itemsCount>=r?A=!0:this.timeLeft<o&&!(this.winChance<1)&&(A=!0)),A}},itemMaxWeight:{get:function(){var A=0;return this.items.forEach(function(e){e>A&&(A=e)}),A}}}),A}var n=t(3).UIHelper,a=[{name:"reinforcedPart",weight:.05,type:"title",value:"Reinforced "},{name:"battleWornPart",weight:2,type:"title",value:"Battle-Worn "},{name:"pristinePart",weight:4,type:"title",value:"Pristine "},{name:"scrapMetal",weight:1,type:"title",value:"Scrap Metal"},{name:"reclaimedMetal",weight:3,type:"title",value:"Reclaimed Metal"},{name:"refinedMetal",weight:9,type:"title",value:"Refined Metal"},{name:"token",weight:1.5,type:"class",value:"token"},{name:"gift",weight:9,type:"title",value:"Gift"},{name:"fabricator",weight:1,type:"title",value:"Fabricator"},{name:"key",weight:180,type:"title",value:"Key"},{name:"taunt",weight:45,type:"slot",value:"taunt"},{name:"ticket",weight:180,type:"title",value:"Ticket"},{name:"action",weight:1,type:"slot",value:"action"},{name:"cosmetic",weight:18,type:"slot",value:"misc"},{name:"uncraftable",weight:.01,type:"class",value:"uncraft"},{name:"strange",weight:18,type:"class",value:"quality11 "},{name:"unusual",weight:1e3,type:"class",value:"quality5 "},{name:"rare",weight:9,type:"class",value:"rarity"},{name:"vintage",weight:1,type:"class",value:"quality3 "},{name:"genuine",weight:1,type:"class",value:"quality1 "},{name:"colored",weight:18,type:"content",value:"div.paintcolor"},{name:"festive on rare",weight:18,type:"content",value:"img.festive"},{name:"festive",weight:18,type:"title",value:"Festive "},{name:"killstreak",weight:27,type:"class",value:"killstreak"}],i=200,r=15,o=2700,s=1.5,l=18;e.Raffle=A()}()},function(A,e){!function(){"use strict";function A(){function A(){var A=$('<div class="panel panel-info"><div class="panel-body">Bot: <span class="botMessage"></span></div></div>');$("body>div.container").prepend(A),o=A}function e(A){o.find("span.botMessage").text(A),console.info(A)}function t(A){var e="";"Ok"===A?e='<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG0QYXBtEGTQbRBk8G0QZPBtEGTwbRBk8G0QZPBtEGTwbRBkkG0QYKAAAAAAAAAAAAAAAAAAAAAAAAAAAG0QYQBtEG5wbRBv8G0Qb/BtEG/wbRBv8G0Qb/BtEG/wbRBv8G0Qb/BtEGwAXRBQAAAAAAAAAAAAAAAAAAAAAABtEGOQbRBv/J9cn/z/bP/6bvpv9/53//nO2c/53tnf/u/O7/l+yX/wbRBvkF0QUHAAAAAAAAAAAAAAAAAAAAAAbRBjoG0Qb/2/jb/yjXKP8G0Qb/EdMR/0zeTP9C3EL/6vvq/6TupP8G0Qb5BdEFCAAAAAAAAAAAAAAAAAAAAAAG0QY6BtEG/9v42/8l1yX/BtEG/xHTEf9M3kz/Nto2/7Xxtf+k7qT/BtEG+QXRBQgAAAAAAAAAAAAAAAAAAAAABtEGOgbRBv/b+Nv/jeqN/xjUGP8S0xL/TN5M/zfaN//F9MX/pO6k/wbRBvkF0QUIAAAAAAAAAAAAAAAAAAAAAAbRBjoG0Qb/2/jb//////+B6IH/FNQU/8X0xf+9873/9v32/6TupP8G0Qb5BdEFCAAAAAAAAAAAAAAAAAAAAAAG0QY6BtEG/9v42///////6vvq/w/TD//z/fP///////////+k7qT/BtEG+QXRBQgAAAAAAAAAAAAAAAAAAAAABtEGOQbRBv/T99P/+f75//n++f+b7Zv/9f31//n++f/5/vn/nu2e/wbRBvkF0QUIAAAAAAAAAAAAAAAAAAAAAAbRBhMG0QbtB9EH/wjRCP8I0Qj/CNEI/wjRCP8I0Qj/CNEI/wfRB/8G0QbHBdEFAQAAAAAAAAAAAAAAAAAAAAAAAAAABtEGHwbRBlsG0QZdBtEGXQbRBl0G0QZdBtEGXQbRBl0G0QZWBtEGDwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//wAA4AcAAMADAADAAwAAwAMAAMADAADAAwAAwAMAAMADAADAAwAAwAMAAOAHAAD//wAA//8AAA==" rel="icon" type="image/x-icon">':"Warning"===A&&(e='<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAADAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABwAAAAcAAAADAAAAmwAHCcIACQvCAAkLwgAJC8IACQvCAAkLwgAJDMIACQzCAAkMwgAJDMIACQzCAAkMwgAJDMIACArDAAAAmwAAAGsAbIf4AMz//wDM//8AzP//AMz//wDM//8Auun/AK/b/wDM//8AzP//AMz//wDM//8AzP//AGyH+QAAAGsAAAAZAA0QtgC24/8AzP//AMz//wDM//8AzP//Ai86/wMLDf8AwvP/AMz//wDM//8AzP//ALfk/wAOEbgAAAAZAAAAAAAAAFAAT2LqAMz//wDM//8AzP//AMz//wF/n/8CYXn/AMv+/wDM//8AzP//AMz//wBRZesAAABSAAAAAAAAAAAAAAAIAAIDngCcw/8AzP//AMz//wDM//8AeZj/AHSR/wDM//8AzP//AMz//wCfx/8AAwShAAAACQAAAAAAAAAAAAAAAAAAADgAMDzYAMr8/wDM//8AzP//ACQt/wAbIv8AzP//AMz//wDL/f8ANEHbAAAAOwAAAAAAAAAAAAAAAAAAAAAAAAABAAAAfQB9nP4AzP//AMz//wAcI/8AFBj/AMz//wDM//8AgqP+AAAAggAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACMAGB7DAL/v/wDM//8AFBn/AA0Q/wDL/v8AwvL/ABwjyAAAACcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXwBgePMAy/7/AA0Q/wAHCf8Ayfv/AGaA9gAAAGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEABwisAKvV/wAPE/8ACgz/AK7Z/wAKDLIAAAAVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARgBCUuIAn8f/AJzD/wBLXecAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAGRAI+y/wCZv/8AAQKbAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALwAlLtAALTnWAAAANgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABvAAAAeQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIABAACAAQAAwAMAAMADAADgBwAA8A8AAPAPAAD4HwAA+B8AAPw/AAD8PwAA/n8AAA==" rel="icon" type="image/x-icon">'),$('link[rel*="icon"]').remove(),$("head").append(e)}function n(A,e,t){t||(t="info"),s=$('<div class="progress"><div class="progress-bar progress-bar-'+t+'" role="progressbar" aria-valuenow="'+100*e+'" aria-valuemin="0" aria-valuemax="100" style="width: '+100*e+'%;">'+A+"</div></div>"),o.find(".botMessage").after(s)}function a(A,e){s.find("div.progress-bar").attr("aria-valuenow",100*A),s.find("div.progress-bar").css("width",100*A+"%"),e&&s.find("div.progress-bar").text(e)}function i(){return parseInt($(".user-notices-count").html())}function r(A,e,t){var n={title:"data-title",slot:"data-slot","class":"class"},a=!1;return a="content"===e?$(A).find(t).length>0:!!A.attr(n[e]).match(t)}var o,s;return{createBotPanel:A,showMessage:e,showIcon:t,addProgress:n,updateProgress:a,getUserNoticeCount:i,checkAttribute:r}}e.UIHelper=new A}()},function(A,e){!function(){"use strict";function A(){function A(A,e){t()&&(localStorage[A]=JSON.stringify(e))}function e(A){var e=void 0;return t()&&localStorage[A]&&(e=JSON.parse(localStorage[A])),e}function t(){return"undefined"!=typeof Storage}return{extract:e,store:A}}e.StorageService=new A}()},function(A,e){!function(){"use strict";function A(){function A(A){return A||(A=.5),Math.floor(1e3*A)+Math.floor(Math.random()*(1e3*A))}function e(A){setTimeout(function(){location.reload()},1e3*A)}return{randomInterval:A,safeReloadRoutine:e}}e.IntervalHelper=new A}()}]);