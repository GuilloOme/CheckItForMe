// ==UserScript==
// @name         CheckItForMe
// @version      0.50
// @match        https://scrap.tf/raffles
// @require      https://code.jquery.com/jquery-2.2.4.min.js#sha256=BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44
// @updateURL    https://raw.githubusercontent.com/GuilloOme/CheckThisForMe/master/dist/check-it-for-me.js
// @grant        none
// ==/UserScript==
!function(A){function e(a){if(t[a])return t[a].exports;var n=t[a]={exports:{},id:a,loaded:!1};return A[a].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var t={};return e.m=A,e.c=t,e.p="",e(0)}([function(A,e,t){!function(){"use strict";function A(){function A(t){var o,u;ScrapTF.Raffles.EnterRaffle=function(A,e){o=A,u=e},i.showMessage("Checking raffle: "+(c+1)+"/"+s.length),$.get(t,function(o){var u=jQuery.Deferred(),w=($(o).find("#raffle-key").val(),$(o).find("button#raffle-enter"));n.isRaffleWorthIt(o)?(w.length>0&&"Enter Raffle"===$(o).find("button#raffle-enter>i18n").html(),u.resolve("Can't enter raffle: "+(c+1)+"/"+s.length+" (no button to click)")):(f.push(t),a(f),u.resolve("Raffle not worth it: "+(c+1)+"/"+s.length)),$.when(u.promise()).then(function(t,a){var n=r.randomInterval();i.showMessage(t),i.updateProgress((c+1)/s.length,c+1+"/"+s.length),a&&(n=r.randomInterval(l)),c++,c<s.length?setTimeout(function(){A(s[c])},n):e.resolve()})})}var e=jQuery.Deferred();return i.addProgress("",0,"success"),A(s[c]),e.promise()}function e(){var A=jQuery.Deferred(),e=setInterval(function(){ScrapTF.Raffles.Pagination.isDone?(A.resolve(),clearInterval(e)):ScrapTF.Raffles.Pagination.LoadNext()},r.randomInterval());return A.promise()}function a(A){w&&(localStorage.badRaffleList=JSON.stringify(A))}var n=t(1).RaffleService,r=t(3).IntervalHelper,i=t(2).UIHelper,o=50,l=3,s=n.goodList,f=n.badList,c=0,u=r.randomInterval(o),w=!1;$(document).ready(function(){i.createBotPanel(),i.showMessage("Started"),"undefined"!=typeof Storage&&(w=!0,"string"!=typeof localStorage.badRaffleList&&a([]),JSON.parse(localStorage.badRaffleList).length>1e3?(console.warn("Purging bad raffle cache!"),a([])):f=f.concat(JSON.parse(localStorage.badRaffleList))),i.getUserNoticeCount()>0&&(i.showMessage("There is new message(s)!"),i.showIcon("Ok")),i.showMessage("Loading all the raffles…"),$.when(e()).then(function(){var e=$("div.panel");if($(e[e.length-1]).find("div.panel-raffle").each(function(A,e){var t=$(e).find("div.raffle-name > a").attr("href");s.push(t)}),s.length>0)$.when(A()).then(function(){console.log("no reload")});else{i.showMessage("No new raffle to enter, waiting…"),i.addProgress("",0);var t=1e3;setInterval(function(){i.updateProgress(t/u),t+=250},250),setTimeout(function(){location.reload()},u)}})})}()},function(A,e,t){!function(){"use strict";function A(){function A(A){var t=e(A),a=!1;return t.count>0&&(t.haveSpecials?a=!0:t.totalEntries<=r?a=!0:t.count>=i?a=!0:t.timeLeft<o&&(a=!0)),a}function e(A){for(var e=$(A).find(".raffle-items>div"),t={timeLeft:Math.floor(parseInt($(A).find("dd.raffle-time-left").attr("data-time"))-(new Date).getTime()/1e3),winChance:parseInt($(A).find("#raffle-win-chance").html()),totalEntries:parseInt($(A).find("span#raffle-num-entries").attr("data-max")),haveSpecials:!1,count:0},a=0;a<=e.length;a++){var r=$(e[a]);"440"===r.attr("data-appid")&&(n(r)&&(t.haveSpecials=!0),t.count++)}return t}function t(A){var e=0;s.forEach(function(t){a.checkAttribute(A,t.type,t.value)&&(e+=t.weight)}),0===e&&(e=.5)}function n(A){return t(A)>=l}var r=300,i=15,o=3600,l=9,s=[{name:"reinforcedPart",weight:.05,type:"title",value:"Reinforced "},{name:"battleWornPart",weight:2,type:"title",value:"Battle-Worn "},{name:"pristinePart",weight:4,type:"title",value:"Pristine "},{name:"scrapMetal",weight:1,type:"title",value:"Scrap Metal"},{name:"reclaimedMetal",weight:3,type:"title",value:"Reclaimed Metal"},{name:"refinedMetal",weight:9,type:"title",value:"Refined Metal"},{name:"token",weight:1.5,type:"class",value:"token"},{name:"gift",weight:9,type:"title",value:"Gift"},{name:"fabricator",weight:1,type:"title",value:"Fabricator"},{name:"key",weight:180,type:"title",value:"Key"},{name:"taunt",weight:45,type:"slot",value:"taunt"},{name:"ticket",weight:180,type:"title",value:"Ticket"},{name:"action",weight:1,type:"slot",value:"action"},{name:"cosmetic",weight:18,type:"slot",value:"misc"},{name:"uncraftable",weight:.01,type:"class",value:"uncraft"},{name:"strange",weight:18,type:"class",value:"quality11 "},{name:"unusual",weight:1e3,type:"class",value:"quality5 "},{name:"rare",weight:9,type:"class",value:"rarity"},{name:"vintage",weight:3,type:"class",value:"quality3 "},{name:"genuine",weight:3,type:"class",value:"quality1 "},{name:"colored",weight:18,type:"content",value:"div.paintcolor"},{name:"festive",weight:18,type:"content",value:"img.festive"},{name:"killstreak",weight:27,type:"class",value:"killstreak"}],f=[],c=[];return{isRaffleWorthIt:A,goodList:f,badList:c}}var a=t(2).UIHelper;e.RaffleService=new A}()},function(A,e){!function(){"use strict";function A(){function A(){var A=$('<div class="panel panel-info"><div class="panel-body">Bot: <span class="botMessage"></span></div></div>');$("body>div.container").prepend(A),o=A}function e(A){o.find("span.botMessage").text(A),console.info(A)}function t(A){var e="";"Ok"===A?e='<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG0QYXBtEGTQbRBk8G0QZPBtEGTwbRBk8G0QZPBtEGTwbRBkkG0QYKAAAAAAAAAAAAAAAAAAAAAAAAAAAG0QYQBtEG5wbRBv8G0Qb/BtEG/wbRBv8G0Qb/BtEG/wbRBv8G0Qb/BtEGwAXRBQAAAAAAAAAAAAAAAAAAAAAABtEGOQbRBv/J9cn/z/bP/6bvpv9/53//nO2c/53tnf/u/O7/l+yX/wbRBvkF0QUHAAAAAAAAAAAAAAAAAAAAAAbRBjoG0Qb/2/jb/yjXKP8G0Qb/EdMR/0zeTP9C3EL/6vvq/6TupP8G0Qb5BdEFCAAAAAAAAAAAAAAAAAAAAAAG0QY6BtEG/9v42/8l1yX/BtEG/xHTEf9M3kz/Nto2/7Xxtf+k7qT/BtEG+QXRBQgAAAAAAAAAAAAAAAAAAAAABtEGOgbRBv/b+Nv/jeqN/xjUGP8S0xL/TN5M/zfaN//F9MX/pO6k/wbRBvkF0QUIAAAAAAAAAAAAAAAAAAAAAAbRBjoG0Qb/2/jb//////+B6IH/FNQU/8X0xf+9873/9v32/6TupP8G0Qb5BdEFCAAAAAAAAAAAAAAAAAAAAAAG0QY6BtEG/9v42///////6vvq/w/TD//z/fP///////////+k7qT/BtEG+QXRBQgAAAAAAAAAAAAAAAAAAAAABtEGOQbRBv/T99P/+f75//n++f+b7Zv/9f31//n++f/5/vn/nu2e/wbRBvkF0QUIAAAAAAAAAAAAAAAAAAAAAAbRBhMG0QbtB9EH/wjRCP8I0Qj/CNEI/wjRCP8I0Qj/CNEI/wfRB/8G0QbHBdEFAQAAAAAAAAAAAAAAAAAAAAAAAAAABtEGHwbRBlsG0QZdBtEGXQbRBl0G0QZdBtEGXQbRBl0G0QZWBtEGDwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//wAA4AcAAMADAADAAwAAwAMAAMADAADAAwAAwAMAAMADAADAAwAAwAMAAOAHAAD//wAA//8AAA==" rel="icon" type="image/x-icon">':"Warning"===A&&(e='<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAADAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABwAAAAcAAAADAAAAmwAHCcIACQvCAAkLwgAJC8IACQvCAAkLwgAJDMIACQzCAAkMwgAJDMIACQzCAAkMwgAJDMIACArDAAAAmwAAAGsAbIf4AMz//wDM//8AzP//AMz//wDM//8Auun/AK/b/wDM//8AzP//AMz//wDM//8AzP//AGyH+QAAAGsAAAAZAA0QtgC24/8AzP//AMz//wDM//8AzP//Ai86/wMLDf8AwvP/AMz//wDM//8AzP//ALfk/wAOEbgAAAAZAAAAAAAAAFAAT2LqAMz//wDM//8AzP//AMz//wF/n/8CYXn/AMv+/wDM//8AzP//AMz//wBRZesAAABSAAAAAAAAAAAAAAAIAAIDngCcw/8AzP//AMz//wDM//8AeZj/AHSR/wDM//8AzP//AMz//wCfx/8AAwShAAAACQAAAAAAAAAAAAAAAAAAADgAMDzYAMr8/wDM//8AzP//ACQt/wAbIv8AzP//AMz//wDL/f8ANEHbAAAAOwAAAAAAAAAAAAAAAAAAAAAAAAABAAAAfQB9nP4AzP//AMz//wAcI/8AFBj/AMz//wDM//8AgqP+AAAAggAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACMAGB7DAL/v/wDM//8AFBn/AA0Q/wDL/v8AwvL/ABwjyAAAACcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXwBgePMAy/7/AA0Q/wAHCf8Ayfv/AGaA9gAAAGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEABwisAKvV/wAPE/8ACgz/AK7Z/wAKDLIAAAAVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARgBCUuIAn8f/AJzD/wBLXecAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAGRAI+y/wCZv/8AAQKbAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALwAlLtAALTnWAAAANgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABvAAAAeQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIABAACAAQAAwAMAAMADAADgBwAA8A8AAPAPAAD4HwAA+B8AAPw/AAD8PwAA/n8AAA==" rel="icon" type="image/x-icon">'),$('link[rel*="icon"]').remove(),$("head").append(e)}function a(A,e,t){t||(t="info"),l=$('<div class="progress"><div class="progress-bar progress-bar-'+t+'" role="progressbar" aria-valuenow="'+100*e+'" aria-valuemin="0" aria-valuemax="100" style="width: '+100*e+'%;">'+A+"</div></div>"),o.find(".botMessage").after(l)}function n(A,e){l.find("div.progress-bar").attr("aria-valuenow",100*A),l.find("div.progress-bar").css("width",100*A+"%"),e&&l.find("div.progress-bar").text(e)}function r(){return parseInt($(".user-notices-count").html())}function i(A,e,t){var a={title:"data-title",slot:"data-slot","class":"class"},n=!1;return n="content"===e?$(A).find(t).length>0:!!A.attr(a[e]).match(t)}var o,l;return{createBotPanel:A,showMessage:e,showIcon:t,addProgress:a,updateProgress:n,getUserNoticeCount:r,checkAttribute:i}}e.UIHelper=new A}()},function(A,e){!function(){"use strict";function A(){function A(A){return A||(A=.5),Math.floor(1e3*A)+Math.floor(Math.random()*(1e3*A))}return{randomInterval:A}}e.IntervalHelper=new A}()}]);